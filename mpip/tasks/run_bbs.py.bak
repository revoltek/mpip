""" Module run_bbs

Define task run_bbs
"""
from ..task import Task
from .. import mylogger

class Run_bbs(Task):

   __name__ = 'run_bbs'
   __doc__ = 'doc for run_bbs'
   banner = 'RUN_BBS: run many istances of BBS'
   arg_list = ['bbs_parset','skymodel','sb','node','obsdir','msname','bbsopt']

   def __init__(self, session):
	Task.__init__(self, session, self.__name__)

   def run(self):
      if self.session._cluster_status == None:
	 self.mylog.error("Not connected to a cluster.")
	 return False

      wdir = self.session.opts.obsdir+'/'+self.session._obs_name+'/SB$SB/'
      datafile = self.session.opts.msname
      command = 'calibrate-stand-alone ' + self.session.opts.bbsopt + ' ' + datafile + ' ' + \
	    self.session.opts.bbs_parset + ' ' + self.session.opts.skymodel + ' >> run_bbs.log'
      return self.session.run_dist_com_all('run_bbs', wdir, command, \
	    self.session.opts.sb, self.session.opts.node)
